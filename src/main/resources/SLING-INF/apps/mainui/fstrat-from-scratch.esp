<!DOCTYPE html>
<html class="no-js css-menubar" lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta name="description" content="bootstrap admin template">
  <meta name="author" content="">
  <title>Simple Layout</title>
  <link rel="stylesheet" href="<%=request.getContextPath()%>/apps/global/css/bootstrap.min599c.css?v4.0.2">
  <link rel="stylesheet" href="<%=request.getContextPath()%>/apps/global/css/bootstrap-extend.min599c.css?v4.0.2">
  <link rel="stylesheet" href="<%=request.getContextPath()%>/apps/global/assets/css/site.min599c.css?v4.0.2">
  
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  
  <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/apps/global/css/custom.css">
  <!--
  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="<%=request.getContextPath()%>/apps/global/js/Cookies.js"></script>
  -->
  
  <!-- <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> -->
  <!-- <script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js'></script>
<link rel="stylesheet" href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css'
    media="screen" /> -->
     <script type="text/javascript"
		src="https://code.jquery.com/jquery-2.1.1.min.js"></script> 
		
		  <!-- Modal script -->

<script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js'></script>
<link rel="stylesheet" href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css'
    media="screen" />
  
</head>
<body class="animsition">
  <div class="row-fluid main-header">
    <div class="container-fluid">
    <div class="col-md-12 menubar">
	    <ul class="pt-5 m-0 pull-left"> 
	    <li><a href="<%=request.getContextPath()%>/servlet/service/ui.index"><img src="<%=request.getContextPath()%>/apps/global/assets/images/lead-auto-convert-logo.png" style="width:205px;margin-left:-60px;"></a></li>
	    <li><a href="<%=request.getContextPath()%>/servlet/service/ui.funnel" target="_blank"> Funnel</a></li>
	    <li><a href="<%=request.getContextPath()%>/servlet/service/ui.list" target="_blank"> List</a></li>
	    <li><a href="<%=request.getContextPath()%>/servlet/service/ui.statistic"> Dashboard</a></li>
	    </ul>
	    <ul class="pt-15 pull-right">
	      <li><a href="<%=request.getContextPath()%>/servlet/service/ui.configuration" target="_blank"><img src="<%=request.getContextPath()%>/apps/global/assets/images/shedule.png"> Configuration</a></li>
	      <li><a href="#" class="creat-new-campaigns-menu"> Create New Campaigns</a></li>
	    </ul>
	  </div>
    </div>
  </div>
  <!-- Page -->
  	<div class="page">
    	<div class="page-content container-fluid">
      		<div class="row">
        		<div class="panel" id="exampleWizardForm" style="width:100%;margin:0px 20px;">
          			<div class="col-lg-12">
            			<div class="panel-body">
	              			<div class="container">
		                		  <div class="row">
                              <div class="col-md-12">
                                  <br>
                                  <h3 class="text-color">Content</h3>
                              </div>
                              <div class="col-md-12">
                              <br>
                                <div class="row">
                                  <div class="col-md-2">
                                    <div class="radio-section text-left p-0">
                                      <label class="containers">Send a Webpage
                                        <input type="radio" name="radio-msg" id="radio" value="send_a_webpage">
                                        <span class="checkmark"></span>
                                      </label>
                                    </div>
                                  </div>
                                  <div class="col-md-3">
                                    <div class="radio-section text-left p-0">
                                      <label class="containers">Compose Message
                                        <input type="radio" name="radio-msg" id="radio2" checked="checked" value="compose_message">
                                        <span class="checkmark"></span>
                                      </label>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="col-md-12 comment-box-part">
                                <br>
                                  <div id="editor-container">
                                    <textarea class="editor1" name="editor1" id="editor1" rows="10" cols="80"></textarea>
                                  </div>
								  <div class="form-group">
                                      <label>Footer</label>
                                      <textarea class="form-control" id="compose_message_footer" rows="5"></textarea>
                                  </div>
                              </div>
                              <div class="col-md-12 aend-a-webpage-section" style="display: none;">
                                  <br>
                                  <div>
                                    <div class="form-group">
                                      <label for="1">Send a webpage - URL</label>
                                      <input type="text" class="form-control" id="send_a_webpage_url" name="" placeholder="http::/abc.com">
                                    </div>
                                    <div class="form-group">
                                      <label>Footer</label>
                                      <textarea class="form-control" id="send_a_webpage_footer" rows="5"></textarea>
                                    </div>
                                  </div>
                              </div>
                          </div>
                          <div class="row">
                              <div class="col-md-12">
                              <br>
                                  <h3 class="text-color">Send As</h3>
                              </div>
                              <div class="col-md-12">
                              <br>
                                <div class="row">
                                  <div class="col-md-1">
                                    <div class="radio-section text-left p-0">
                                      <label class="containers">Html
                                        <input type="radio" name="radio-tag" id="radio-tag" value="html">
                                        <span class="checkmark"></span>
                                      </label>
                                    </div>
                                  </div>
                                  <div class="col-md-1">
                                    <div class="radio-section text-left p-0">
                                      <label class="containers">Text
                                        <input type="radio" name="radio-tag" id="radio-tag-2" checked="checked" value="text">
                                        <span class="checkmark"></span>
                                      </label>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="col-md-12 drop-down-part">
                                <br>
                                  <div class="row">
                                      <div class="col-md-3">
                                          <div class="form-group">
                                              <label class="containers">Use Tamplate</label>
                                              <select class="custom-btn form-control">
                                                <option value="">New Tamplate</option>
                                                <option value="">Email 1</option>
                                                <option value="">Email 2</option>
                                                <option value="">Email 3</option>
                                              </select>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                              <div class="col-md-12 drop-down-part-second" style="display:none;">
                                  <br>
                                  <div class="row">
                                      <div class="col-md-3">
                                          <div class="form-group">
                                              <label class="containers">Use Tamplate</label>
                                              <select class="custom-btn form-control">
                                                <option value="">New Tamplate</option>
                                                <option value="">Email 1</option>
                                                <option value="">Email 2</option>
                                                <option value="">Email 3</option>
                                              </select>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
	              			</div>
                      <div class="wizard-buttons">
                        <a class="btn btn-primary btn-outline custom-btn float-right" id="save_campaign" href="#" data-wizard="next" role="button" style="margin-right:5px;">Save</a>
                        <!-- 
                        <a class="btn btn-default btn-outline disabled" href="#" data-wizard="back" role="button">Back</a>
                        <a class="btn btn-primary btn-outline custom-btn float-right" href="#" data-wizard="next" role="button">Next</a>
                        <a class="btn btn-success btn-outline float-right hidden-xs-up" href="#exampleWizardForm" data-wizard="finish" role="button">Finish</a>
                        -->
                      </div>
                  </div>
                </div>
      			</div>
    		</div>
  		</div>
  </div>
  
  <!-- Modal Popup -->
<div id="MyPopup" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
           
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <input type="button" id="btnClosePopup" value="Close" class="btn btn-danger" />
            </div>
        </div>
    </div>
</div>
    <script  type="text/javascript">
    
    $(function () {
    	  
        $("#btnClosePopup").click(function () {
            $("#MyPopup").modal("hide");
            window.close();
        });
    });
	    var msg_type="compose_message";
		var send_as="text";
        $('input[type=radio][name=radio-msg]').change(function() {
		    msg_type=this.value;
			//alert("msg_type : "+msg_type);
	    });
		
		$('input[type=radio][name=radio-tag]').change(function() {
		    send_as=this.value;
		    //alert("send_as : "+send_as);
	    });
	
         $('#save_campaign').on('click', saveCampaign);
	     function saveCampaign(event){
		      var campaignName=localStorage.getItem('campaignName');
	          var fromName=localStorage.getItem('fromName');
			  var fromEmailAddress=localStorage.getItem('fromEmailAddress');
			  var funnelName=localStorage.getItem('funnelName');
			  var SubFunnelName=localStorage.getItem('SubFunnelName');
			  var DistanceBtnCampaign=localStorage.getItem('DistanceBtnCampaign');
			  var listid=localStorage.getItem('listid');
			  var subjectName=localStorage.getItem('subjectName');
			  var footer="";
			  var compose_message_txt="";
			  var send_a_webpage_url="";
		    if (msg_type == 'send_a_webpage') {
			    //alert("this.value : "+msg_type);
				send_a_webpage_url=document.getElementById('send_a_webpage_url').value;
				footer=document.getElementById('send_a_webpage_footer').value;
				//footer=footer+"<p><small><a href='[UNSUBSCRIBEURL]'>unsubscribe me</a></small></p>";
				console.log("msg_type : "+msg_type+"\n"+"send_a_webpage_url : "+send_a_webpage_url+"\n"+"send_a_webpage_footer : "+footer+"\n"+"send_as : "+send_as);
			}
			else if (msg_type == 'compose_message') {
			     //var content = CKEDITOR.instances['DSC'].getData();
				 //var content = $('textarea.editor1').val();
				//var content = CKEDITOR.instances.editor1.getData();
				//alert("content : "+content);
			    compose_message_txt=CKEDITOR.instances.editor1.getData();
			    //compose_message_txt=compose_message_txt+"<p><small><a href='[UNSUBSCRIBEURL]'>unsubscribe me</a></small></p>";
			    compose_message_txt=compose_message_txt.replace(/(\r\n|\n|\r)/gm, "");
				//compose_message_txt=compose_message_txt.replace('">','?email=[email]">');
				compose_message_txt=compose_message_txt.replace(/">/g,'?EMAIL=[EMAIL]">');
				compose_message_txt=compose_message_txt.replace(/&nbsp;/g,'');
			    footer=document.getElementById('compose_message_footer').value;
				//footer=footer+"<p><small><a href='[UNSUBSCRIBEURL]'>unsubscribe me</a></small></p>";
				//alert("msg_type : "+msg_type+"\n"+"compose_message_txt : "+compose_message_txt+"\n"+"compose_message_footer : "+footer+"\n"+"send_as : "+send_as);
				
				compose_message_txt.replace(/(^\w+:|^)\/\//, ''); 
				//replace https 
			
				

				console.log("compose_message_txt : "+compose_message_txt);
			}else{
				alert("You have selected something else");
			}
		    // new by tejal
		
		   // compose_message_txt="<!DOCTYPE html><html><body>"+compose_message_txt+"</body></html>";
			console.log('new compose_message_txt new : '+compose_message_txt);
			
			var remoteuser=localStorage.getItem('remoteuser');
			var groupname=localStorage.getItem('groupname');
		 
			$.ajax({
					//url: '<%=request.getContextPath()%>/servlet/service/uidata.createLead',
					  url: '<%=request.getContextPath()%>/servlet/service/createCampaign.CampaignNodeAdd',//createListAndSubscribers
					//url: '<%=request.getContextPath()%>/servlet/service/createCampaign.addCampaign',
					type: 'POST',
					async:false,
					data: {
						
						  footer:footer,
						  send_a_webpage_url:send_a_webpage_url,
					      compose_message_txt:compose_message_txt,
					       ckcontent:compose_message_txt,
						   subject : subjectName,
						   campaignName : campaignName,
						   fromName : fromName,
						   fromEmailAddress : fromEmailAddress,
						   funnelName : funnelName,
						   SubFunnelName : SubFunnelName,
						   DistanceBtnCampaign : DistanceBtnCampaign,
						   listid : listid,
						   logged_in_user:localStorage.getItem('remoteuser'),
						   group : groupname,
						  },
					cache: false,
					//dataType: 'json',
					//processData: false, 
					//contentType: false, 
					success: function(data)
					{
						//console.log('--------------markup---------start');
	                    console.log('data : '+data);
						var jsonData = JSON.parse(data);
						//Cookies.set('campaignid',jsonData.campaignid);
						if(SubFunnelName === "Explore"){
							console.log("SubFunnelName= "+SubFunnelName);
							localStorage.setItem('Expcampaignid',jsonData.campaignid);
						}else{}
						localStorage.setItem('campaignid',jsonData.campaignid);
						console.log('campaignid : '+jsonData.campaignid);
					//	alert("Your Campaign Is saved and Campaign Id Is "+jsonData.campaignid);
					var body = '<h3>Your Campaign created Successfully</h3>';
					  $("#MyPopup .modal-body").html(body);
				    $("#MyPopup").modal("show");
						//campaignid
	                    //console.log('--------------markup---------end');
	                    //alert('data: '+data);
						//window.location = "<%=request.getContextPath()%>/servlet/service/ui.index";
					//	window.close();
					}
					});
	            
		 }
  </script>
  <script data-cfasync="false" src="../../../cdn-cgi/scripts/d07b1474/cloudflare-static/email-decode.min.js"></script><script src="../../global/vendor/babel-external-helpers/babel-external-helpers599c.js?v4.0.2"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
  <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
  <script src="<%=request.getContextPath()%>/apps/global/vendor/babel-external-helpers/babel-external-helpers599c.js?v4.0.2"></script> 
  <script src="<%=request.getContextPath()%>/apps/global/vendor/jquery/jquery.min599c.js?v4.0.2"></script>
  <script src="<%=request.getContextPath()%>/apps/global/vendor/popper-js/umd/popper.min599c.js?v4.0.2"></script>
  <script src="<%=request.getContextPath()%>/apps/global/vendor/bootstrap/bootstrap.min599c.js?v4.0.2"></script>
  <script src="<%=request.getContextPath()%>/apps/global/vendor/asscrollbar/jquery-asScrollbar.min599c.js?v4.0.2"></script>
  <script src="<%=request.getContextPath()%>/apps/global/vendor/formvalidation/formValidation.min599c.js?v4.0.2"></script>
  <!-- <script src="<%=request.getContextPath()%>/apps/global/vendor/jquery-wizard/jquery-wizard.min599c.js?v4.0.2"></script> -->
  <script src="<%=request.getContextPath()%>/apps/global/js/Plugin.min599c.js?v4.0.2"></script>
  <script src="<%=request.getContextPath()%>/apps/global/js/Config.min599c.js?v4.0.2"></script>
  <!-- <script src="<%=request.getContextPath()%>/apps/global/js/Plugin/jquery-wizard.min599c.js?v4.0.2"></script> -->
  <!-- <script src="<%=request.getContextPath()%>/apps/global/assets/examples/js/forms/wizard.min599c.js?v4.0.2"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.js"></script>

  <script src="<%=request.getContextPath()%>/apps/global/js/custom.js"></script>
  <!-- 
  <script src="<%=request.getContextPath()%>/apps/global/js/Cookies.js"></script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  -->
  
  <script type="text/javascript" src="https://cdn.ckeditor.com/4.5.1/standard/ckeditor.js"></script>
  
  <script>
    CKEDITOR.editorConfig = function (config) {
    config.language = 'es';
    config.uiColor = '#F7B42C';
    config.height = 300;
    config.toolbarCanCollapse = true;
  };
  CKEDITOR.replace('editor1');
  var brandImg = document.querySelectorAll("#brand-img img");

  for (var i = 0; i < brandImg.length; i++) {if (window.CP.shouldStopExecution(1)){break;}
      ckEdiloop = brandImg[i];
	  alert('ckEdiloop : '+ckEdiloop);
      ckEdiloop.addEventListener("click", function(el){
          ckEdImg = '<p><img src="'+this.src+'" /></p>'; // La forma como las imágenes son envueltas en ckEditor
		  //alert('ckEdImg : '+ckEdImg);
          CKEDITOR.instances['editor1'].insertHtml(ckEdImg) // Añade img al editor
      });
  }
  window.CP.exitedLoop(1);
</script>
</body>
</html>