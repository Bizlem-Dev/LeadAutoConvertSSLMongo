<!DOCTYPE html>
<html class="no-js css-menubar" lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta name="description" content="bootstrap admin template">
  <meta name="author" content="">
  <title>Select Tamplate File</title>
  
  <link rel="stylesheet" href="<%=request.getContextPath()%>/apps/global/css/bootstrap.min599c.css?v4.0.2">
  <link rel="stylesheet" href="<%=request.getContextPath()%>/apps/global/css/bootstrap-extend.min599c.css?v4.0.2">
  <link rel="stylesheet" href="<%=request.getContextPath()%>/apps/global/assets/css/site.min599c.css?v4.0.2">
  
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  
  <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/apps/global/css/custom.css">
  <!--
  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="<%=request.getContextPath()%>/apps/global/js/Cookies.js"></script>
  -->
  
     <script type="text/javascript"
		src="https://code.jquery.com/jquery-2.1.1.min.js"></script> 
	
  <!-- Modal script -->
<script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js'></script>
<link rel="stylesheet" href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css'
    media="screen" />
 
	
  <style type="text/css">
    input[type="file"] { 
    z-index: -1;
    position: absolute;
    opacity: 0;
  }
  .plus-box i{
    font-size:20px;
    padding-top:20px;
  }
  .plus-box p{
    padding:5px 0px 15px 0px;
  }
  .append-section{
    padding:50px;
  }
  </style>
</head>
<body class="animsition">
  <div class="row-fluid main-header">
    <div class="container-fluid">
      <div class="col-md-12 menubar">
	    <ul class="pt-5 m-0 pull-left"> 
	    <li><a href="<%=request.getContextPath()%>/servlet/service/ui.index"><img src="<%=request.getContextPath()%>/apps/global/assets/images/lead-auto-convert-logo.png" style="width:205px;margin-left:-60px;"></a></li>
	    <li><a href="<%=request.getContextPath()%>/servlet/service/ui.funnel" target="_blank"> Funnel</a></li>
	    <li><a href="<%=request.getContextPath()%>/servlet/service/ui.list" target="_blank"> List</a></li>
	    <li><a href="<%=request.getContextPath()%>/servlet/service/ui.statistic"> Dashboard</a></li>
	    </ul>
	    <ul class="pt-15 pull-right">
	      <li><a href="<%=request.getContextPath()%>/servlet/service/ui.configuration" target="_blank"><img src="<%=request.getContextPath()%>/apps/global/assets/images/shedule.png"> Configuration</a></li>
	      <li><a href="#" class="creat-new-campaigns-menu"> Create New Campaigns</a></li>
	    </ul>
	  </div>
    </div>
  </div>
  <!-- Page -->
  	<div class="page">
    	<div class="page-content container-fluid">
      		<div class="row">
        		<div class="panel" id="exampleWizardForm" style="width:100%;margin:0px 20px;">
          			<div class="col-lg-12">
            			<div class="panel-body">
	              			<div class="container">
		                		  <div class="row">
                            <div class="plus-box text-center plus-box-last col-md-4 imag-box-content-main p-0">
                                <a href="#">
                                  <div class="imag-box-content border-set rounded" style="position: relative;">
                                      <i class="fa fa-plus" aria-hidden="true"></i> 
                                      <p><label>Upload Template</label><h5>(File should be in HTML Format)</h5></p>
                                      <input type="file" id="file-upload"/>
                                      <label for="file-upload" style="position: absolute; top: 0px; bottom: 0px; width: 100%; left: 0px;"></label>
                                      <div id="file-upload-filename" style="position:absolute;margin:-8% 0px 0px 15% !important;"></div>
                                  </div>
                                </a>
                            </div>
                          </div>
                          <div class="row">
                              <div class="col-md-12 border-set append-section mt-4" id="uploded_content" contenteditable="true">
                                  code hear
                              </div>
                          </div>
	              			</div>
	              	  
                      <div class="wizard-buttons mt-4">
                      <a class="btn btn-primary btn-outline custom-btn float-right" id="save_campaign" href="#" data-wizard="next" role="button" style="margin-right:5px;">Save</a>
                        <!--
                        <a class="btn btn-default btn-outline disabled" href="#" data-wizard="back" role="button">Back</a>
                        <a class="btn btn-primary btn-outline custom-btn float-right" href="#" data-wizard="next" role="button">Next</a>
						<a class="btn btn-primary btn-outline custom-btn float-right" id="save_campaign" href="#" data-wizard="next" role="button" style="margin-right:5px;">Save</a>
                        <a class="btn btn-success btn-outline float-right hidden-xs-up" href="#exampleWizardForm" data-wizard="finish" role="button">Finish</a>
                        -->
                      </div>
                  </div>
                </div>
      			</div>
    		</div>
  		</div>
  </div>
   <!-- Modal Popup -->
<div id="MyPopup" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
           
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <input type="button" id="btnClosePopup" value="Close" class="btn btn-danger" />
            </div>
        </div>
    </div>
</div>
  <script data-cfasync="false" src="../../../cdn-cgi/scripts/d07b1474/cloudflare-static/email-decode.min.js"></script><script src="../../global/vendor/babel-external-helpers/babel-external-helpers599c.js?v4.0.2"></script>
  
<!--   <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>  -->
  <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
  
  <script src="<%=request.getContextPath()%>/apps/global/vendor/jquery/jquery.min599c.js?v4.0.2"></script>
  <script src="<%=request.getContextPath()%>/apps/global/vendor/popper-js/umd/popper.min599c.js?v4.0.2"></script>
  <script src="<%=request.getContextPath()%>/apps/global/vendor/bootstrap/bootstrap.min599c.js?v4.0.2"></script>
  <script src="<%=request.getContextPath()%>/apps/global/vendor/asscrollbar/jquery-asScrollbar.min599c.js?v4.0.2"></script>
  <script src="<%=request.getContextPath()%>/apps/global/vendor/formvalidation/formValidation.min599c.js?v4.0.2"></script>
  <!-- <script src="<%=request.getContextPath()%>/apps/global/vendor/jquery-wizard/jquery-wizard.min599c.js?v4.0.2"></script> -->
  <script src="<%=request.getContextPath()%>/apps/global/js/Plugin.min599c.js?v4.0.2"></script>
  <script src="<%=request.getContextPath()%>/apps/global/js/Config.min599c.js?v4.0.2"></script>
  <!-- <script src="<%=request.getContextPath()%>/apps/global/js/Plugin/jquery-wizard.min599c.js?v4.0.2"></script> -->
  <!-- <script src="<%=request.getContextPath()%>/apps/global/assets/examples/js/forms/wizard.min599c.js?v4.0.2"></script> -->
  
  
  <script type="text/javascript" src="https://cdn.ckeditor.com/4.5.1/standard/ckeditor.js"></script>
  <script src="<%=request.getContextPath()%>/apps/global/js/custom.js"></script>
  <!-- 
  <script src="<%=request.getContextPath()%>/apps/global/js/Cookies.js"></script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
   <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  -->
 
	
  <script type="text/javascript">
  
  $(function () {
	  
      $("#btnClosePopup").click(function () {
          $("#MyPopup").modal("hide");
          window.close();
      });
  });
    var uploded_content="";
    var input = document.getElementById( 'file-upload' );
    var infoArea = document.getElementById( 'file-upload-filename' );
    input.addEventListener( 'change', showFileName );
    function showFileName( event ) {
      var input = event.srcElement;
      var fileName = input.files[0].name;
      infoArea.textContent = 'File name: ' + fileName;
	  
	    var fileInput = document.getElementById('selectedFile1');
		var fileDisplayArea = document.getElementById('uploded_content');
		
		var file = input.files[0];
			var textType = /html.*/;

        if (file.type.match(textType)) {
				var reader = new FileReader();
                reader.readAsText(file);
				reader.onload = function(e) {
					fileDisplayArea.innerHTML = reader.result;
					uploded_content=reader.result;
					//console.log("reader.result : "+reader.result);
				}

				//reader.readAsText(file);	
			} else {
				fileDisplayArea.innerHTML = "File type not supported upload Only Html File!"
			}
			
		/*
		fileInput.addEventListener('change', function(e) {
			var file = fileInput.files[0];
			var textType = /html.Star is here/;

			if (file.type.match(textType)) {
				var reader = new FileReader();

				reader.onload = function(e) {
					fileDisplayArea.innerHTML = reader.result;
				}

				reader.readAsText(file);	
			} else {
				fileDisplayArea.innerHTML = "File type not supported!"
			}
		});
		*/
		
	  /*
	  // use the 1st file from the list
    var f = input.files[0];

    var reader = new FileReader();
    alert("reader : "+reader);
    // Closure to capture the file information.
    
    reader.onload = (function(theFile) {
        return function(e) {

          jQuery( '#uploded_content' ).val( e.target.result );
        };
      })(f);
     
      // Read in the image file as a data URL.
      reader.readAsText(f);
	  alert("reader.readAsText(f) : "+reader.readAsText(f));
	  */
    }
	$('#save_campaign').on('click', saveCampaign);
	    function saveCampaign(event){
		      var uploded_content1=document.getElementById('uploded_content').innerHTML;
		    //  uploded_content=uploded_content.replace(/">/g,'?EMAIL=[EMAIL]">');
			  console.log("uploded_content1 new  : "+uploded_content1);
			  //alert("uploded_content : "+uploded_content);
			  console.log("uploded_content : "+uploded_content);
			  var campaignName=localStorage.getItem('campaignName');
	          var fromName=localStorage.getItem('fromName');
			  var fromEmailAddress=localStorage.getItem('fromEmailAddress');
			  var funnelName=localStorage.getItem('funnelName');
			  var SubFunnelName=localStorage.getItem('SubFunnelName');
			  var DistanceBtnCampaign=localStorage.getItem('DistanceBtnCampaign');
			  var listid=localStorage.getItem('listid');
			  var subjectName=localStorage.getItem('subjectName');
			  var remoteuser=localStorage.getItem('remoteuser');
				var groupname=localStorage.getItem('groupname');
			
			  
			     $.ajax({
					//url: '<%=request.getContextPath()%>/servlet/service/uidata.createLead',
					url: '<%=request.getContextPath()%>/servlet/service/createCampaign.CampaignNodeAdd',//createListAndSubscribers
					//url: '<%=request.getContextPath()%>/servlet/service/createCampaign.addCampaign',
					type: 'POST',
					async:false,
					data: {
					       ckcontent:uploded_content,
						   subject : subjectName,
						   campaignName : campaignName,
						   fromName : fromName,
						   fromEmailAddress : fromEmailAddress,
						   funnelName : funnelName,
						   SubFunnelName : SubFunnelName,
						   DistanceBtnCampaign : DistanceBtnCampaign,
						   listid : listid,
						   logged_in_user:localStorage.getItem('remoteuser'),
						   group : groupname,
						  },
					cache: false,
					//dataType: 'json',
					//processData: false, 
					//contentType: false, 
					success: function(data)
					{
						//console.log('--------------markup---------start');
	                    console.log('data : '+data);
						var jsonData = JSON.parse(data);
						//Cookies.set('campaignid',jsonData.campaignid);
						localStorage.setItem('campaignid',jsonData.campaignid);
						//campaignid
	                    //console.log('--------------markup---------end');
	                    //alert('data: '+data);
	                    console.log("Your Campaign Is saved and Campaign Id Is "+jsonData.campaignid);
	                    var body = '<h3>Your Campaign created Successfully</h3>';
					  $("#MyPopup .modal-body").html(body);
				    $("#MyPopup").modal("show");
						
						//campaignid
	                    //console.log('--------------markup---------end');
	                    //alert('data: '+data);
						//window.location = "<%=request.getContextPath()%>/servlet/service/ui.index";
					//	window.close();
					}
					});
					
	    }
  </script>
</body>
</html>